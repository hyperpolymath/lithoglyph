# SPDX-License-Identifier: AGPL-3.0-or-later
# FormBD Studio - Build commands

# Default recipe
default:
    @just --list

# Setup development environment
setup:
    @echo "Setting up FormBD Studio..."
    deno cache src/main.tsx
    cd src-tauri && cargo build
    just rescript-build

# Build ReScript files
rescript-build:
    deno run -A npm:rescript build

# Watch ReScript files
rescript-watch:
    deno run -A npm:rescript build -w

# Bundle frontend for production
bundle:
    just rescript-build
    deno run -A npm:esbuild src/main.tsx --bundle --outfile=dist/app.js --format=esm --jsx=automatic --loader:.js=jsx

# Development mode with hot reload
dev:
    just bundle
    cargo tauri dev

# Build for production
build:
    just bundle
    cargo tauri build

# Type check Lean 4 proofs
check-proofs:
    cd ../fbqldt && lake build

# Format code
fmt:
    deno fmt src/*.tsx
    cd src-tauri && cargo fmt

# Lint
lint:
    cd src-tauri && cargo clippy

# Clean build artifacts
clean:
    rm -rf dist/app.js
    rm -rf src/*.res.js
    cd src-tauri && cargo clean
