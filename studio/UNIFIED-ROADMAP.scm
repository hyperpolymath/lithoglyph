; SPDX-License-Identifier: PMPL-1.0-or-later
; FormBD Ecosystem - Unified Roadmap to MVP 1.0.0
; Media-Type: application/vnd.roadmap+scm
;
; This file is distributed to all FormBD ecosystem repos:
; - formbd (core database)
; - fdql-dt (dependently-typed query language)
; - formbd-studio (GUI)
; - formbd-debugger (recovery tool)

(unified-roadmap
  (metadata
    (version "1.0.0")
    (created "2026-01-12")
    (updated "2026-01-12")
    (author "hyperpolymath")
    (target "MVP 1.0.0"))

  ;; ============================================================================
  ;; ECOSYSTEM OVERVIEW
  ;; ============================================================================
  (ecosystem-summary
    (components
      (formbd
        (version "0.0.4")
        (completion 70)
        (role "Core database engine")
        (tech "Forth + Factor + Zig"))
      (fdql-dt
        (version "0.2.0")
        (completion 65)
        (role "Dependently-typed query language")
        (tech "Lean 4 + Zig"))
      (formbd-studio
        (version "0.1.0")
        (completion 45)
        (role "Zero-friction GUI")
        (tech "ReScript + Tauri 2.0 + Rust"))
      (formbd-debugger
        (version "0.1.0")
        (completion 55)
        (role "Proof-carrying recovery tool")
        (tech "Lean 4 + Idris 2 + Rust")))

    (architecture
      "┌─────────────────────────────────────────────────────────────┐"
      "│  FormBD Studio (GUI)                                        │"
      "│    ↓ generates FBQLdt code                                   │"
      "├─────────────────────────────────────────────────────────────┤"
      "│  FBQLdt (Lean 4)                                             │"
      "│    ↓ compiles to proof blobs                                │"
      "├─────────────────────────────────────────────────────────────┤"
      "│  Form.Bridge (Zig ABI)                                      │"
      "│    ↓ calls                                                  │"
      "├─────────────────────────────────────────────────────────────┤"
      "│  FormBD Core (Forth + Factor)                               │"
      "│    Form.Runtime → Form.Normalizer → Form.Model → Form.Blocks│"
      "├─────────────────────────────────────────────────────────────┤"
      "│  FormBD Debugger (alongside)                                │"
      "│    ↓ proves recovery safe                                   │"
      "│  FormBD + FBQLdt                                             │"
      "└─────────────────────────────────────────────────────────────┘"))

  ;; ============================================================================
  ;; CRITICAL PATH TO MVP 1.0.0
  ;; ============================================================================
  (critical-path
    (phase (id "P1") (name "Core Integration")
      (duration "weeks 1-6")
      (focus "FormBD + FBQLdt integration")

      (formbd-tasks
        (task "Complete M11: HTTP API Server" priority: critical status: in-progress)
        (task "Expose Form.Bridge FFI for proof verification" priority: high status: pending)
        (task "Add CBOR proof blob acceptance in query path" priority: high status: pending))

      (fdql-dt-tasks
        (task "M5: Zig FFI bridge to Form.Bridge" priority: critical status: not-started)
        (task "M6: FBQL parser (integrate with FormBD's EBNF)" priority: high status: not-started)
        (task "Proof blob serialization (CBOR RFC 8949)" priority: high status: pending))

      (checkpoint "FBQLdt can compile a query → proof blob → FormBD accepts and executes"))

    (phase (id "P2") (name "User-Facing Tools")
      (duration "weeks 7-10")
      (focus "Studio and Debugger completion")

      (studio-tasks
        (task "Verify ReScript/Tauri build pipeline" priority: critical status: pending)
        (task "Wire ReScript UI to FBQLdt code generation" priority: high status: pending)
        (task "Connect to FormBD HTTP API" priority: high status: blocked)
        (task "Test schema creation → query → results flow" priority: medium status: pending))

      (debugger-tasks
        (task "Wire Idris REPL to PostgreSQL adapter" priority: high status: pending)
        (task "FormBD adapter: parse real journal files" priority: high status: partial)
        (task "Complete Ratatui TUI interface" priority: medium status: in-progress)
        (task "Integration: proof verification before recovery" priority: medium status: pending))

      (checkpoint "Users can create schemas in Studio, debug with Debugger"))

    (phase (id "P3") (name "Production Hardening")
      (duration "weeks 11-12")
      (focus "Stability and polish")

      (all-repos
        (task "Crash recovery tests" priority: high)
        (task "Error handling improvements" priority: high)
        (task "Cross-platform testing" priority: medium)
        (task "Documentation completion" priority: medium)
        (task "Performance optimization" priority: low))

      (checkpoint "MVP 1.0.0 release ready")))

  ;; ============================================================================
  ;; DEPENDENCY GRAPH
  ;; ============================================================================
  (dependencies
    (formbd-m11
      (name "FormBD HTTP API Server")
      (blocks "Studio M2" "Debugger FormBD adapter")
      (priority critical))

    (fdql-dt-m5
      (name "FBQLdt Zig FFI Bridge")
      (blocks "Studio M3" "Real type checking")
      (depends-on "FormBD Form.Bridge")
      (priority critical))

    (fdql-dt-m6
      (name "FBQLdt FBQL Parser")
      (blocks "Full FBQLdt compilation")
      (depends-on "fdql-dt-m5")
      (priority high))

    (studio-m1
      (name "Studio Build Pipeline")
      (blocks "All Studio features")
      (priority critical))

    (debugger-repl-db
      (name "Debugger REPL Database Connection")
      (blocks "Real debugging")
      (priority high)))

  ;; ============================================================================
  ;; UNRESOLVED DECISIONS
  ;; ============================================================================
  (decisions-needed
    (decision (id "DECISION-002")
      (title "FBQLdt parser approach")
      (repo "fdql-dt")
      (options
        "Hand-rolled parser (simple, no deps)"
        "Lean 4 Parsec (built-in)"
        "Integrate with FormBD's Factor-based FDQL parser")
      (recommendation "Integrate - reuse FormBD's EBNF grammar via FFI")
      (impact "Affects M6 implementation"))

    (decision (id "DECISION-003")
      (title "FormBD integration strategy for FBQLdt")
      (repo "fdql-dt")
      (options
        "Mock Forth core for MVP"
        "Real Form.Bridge integration")
      (recommendation "Real integration - M11 HTTP API makes this feasible")
      (impact "Determines MVP scope")))

  ;; ============================================================================
  ;; POST-MVP ROADMAP
  ;; ============================================================================
  (post-mvp
    (release (version "1.1.0") (name "Normalization & Migration")
      (features
        "Form.Normalizer full integration (FD discovery → decomposition)"
        "Three-phase migration workflow (Announce/Shadow/Commit)"
        "Studio: visual normalization wizard"
        "Debugger: migration rollback proofs"))

    (release (version "1.2.0") (name "Multi-Database Support")
      (features
        "Debugger: SQLite adapter completion"
        "FormBD: clustering/replication (Form.ControlPlane begins)"
        "Studio: connection manager for multiple DBs"))

    (release (version "2.0.0") (name "Agentic Ecosystem")
      (features
        "Form.ControlPlane (Elixir/OTP) for distributed coordination"
        "Agent handover protocols"
        "Long-term archive format standardization"
        "Multi-user collaboration in Studio")))

  ;; ============================================================================
  ;; SUCCESS METRICS
  ;; ============================================================================
  (success-metrics
    (mvp-criteria
      "User can create a schema in Studio with visual builder"
      "Schema generates valid FBQLdt with type checking"
      "User can insert data with provenance tracking"
      "User can query data and see results"
      "Debugger can analyze schema and propose fixes"
      "All operations have proof-carrying verification")

    (quality-gates
      "All ReScript code compiles without warnings"
      "All Rust code passes Clippy lints"
      "All Lean 4 code builds with lake"
      "Cross-platform builds succeed (Mac/Windows/Linux)"
      "Integration tests pass end-to-end")))
